{{ define "main" }}
{{ if not hugo.IsProduction }}{{ "<!-- single.html: start -->" | safeHTML }}{{ end }}

{{ $page := .Page }}
{{ $importPath := or $page.Params.import_path (partial "function/getImportPath.html" $page.Permalink) }}

<div id="detail-view">

  <section>
    <h2>{{ .Title }}</h2>
    <p>
      {{ with .Params.description }}
        {{ . }}
      {{ else }}
        {{ partial "function/render.html" (i18n "single.defaultDescription"
                                                (dict "Title" .Title)) }}
      {{ end }}
    </p>
  </section>


  {{ with $importPath }}
    <section>
      <h4>
        {{ partial "function/render.html" (i18n "single.installHeadline") }}
      </h4>
      <p>
        {{ partial "function/render.html" (i18n "single.installDesc") }}
      </p>

      <span class="language-bash">
        {{ partial "function/render.html" (i18n "single.installCommand"
                                                (dict "ImportPath" .)) }}
      </span>
    </section>

    <section>
      <h4>
        {{ partial "function/render.html" (i18n "single.upgradeHeadline") }}
      </h4>
      <p>
        {{ partial "function/render.html" (i18n "single.upgradeDesc") }}
      </p>

      <span class="language-bash">
        {{ partial "function/render.html" (i18n "single.upgradeCommand"
                                                (dict "ImportPath" .)) }}
      </span>
    </section>
  {{ end }}


  <section>
    <h4>
      {{ partial "function/render.html" (i18n "single.resourcesHeadline") }}
    </h4>

    {{ $urls := $page.Params.urls }}
    {{ $repoRoot := $page.Params.repo.root }}
    {{ $fallbackSource := cond $repoRoot (printf "https://%s" $repoRoot) "" }}

    {{/* Read urls.source (supports nested key lookups and site fallback) */}}
    {{ $sourceParam := $page.Param "urls.source" }}

    {{/* If urls.source is present:
          - a string => use it
          - false (boolean) => keep it false to suppress link
          If urls.source is absent => fall back to https://<repo root> (when available). */}}
    {{ $sourceURL := default $fallbackSource $sourceParam }}

    <table class="striped">
      <thead>
        <tr>
          <th scope="col">
             {{ partial "function/render.html" (i18n "single.resourcesThType") }}
          </th>
          <th scope="col">
             {{ partial "function/render.html" (i18n "single.resourcesThValue") }}
          </th>
        </tr>
      </thead>
      <tbody>
      {{ with $urls.doc }}
        <tr>
          <td>
            {{ partial "function/render.html" (i18n "single.resourcesDocumentation") }}
          </td>
          <td>
            <a href="{{ . }}">{{ . }}</a>
          </td>
        </tr>
      {{ end }}
      {{ with $urls.website }}
        <tr>
          <td>
            {{ partial "function/render.html" (i18n "single.resourcesWebsite") }}
          </td>
          <td>
            <a href="{{ . }}">{{ . }}</a>
          </td>
        </tr>
      {{ end }}
      {{ with $sourceURL }}
        <tr>
          <td>
            {{ partial "function/render.html" (i18n "single.resourcesSourceCode") }}
          </td>
          <td>
            <a href="{{ . }}">{{ . }}</a>
          </td>
        </tr>
      {{ end }}
      </tbody>
    </table>
  </section>

  {{ with .Content }}
  <section>
    {{ . }}
  </section>
  {{ end }}

</div>

{{ if not hugo.IsProduction }}{{ "<!-- single.html: end -->" | safeHTML }}{{ end }}
{{ end }}
